<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<link rel="stylesheet" type="text/css" href="assets/text-input.css">
		<link href="https://fonts.googleapis.com/css?family=Mukta" rel="stylesheet">
	</head>
	<body>
		<script>
			// disable Ctrl+V for the input
			window.onload = function() {
				document.getElementById("input").onpaste = function(e) {
					e.preventDefault();
				}
			}

			var phrase = "The quick brown fox jumps over the lazy dog";
			var errorCount = 0;
			var started = false;
			var startTime, endTime;

			function getKey(event) {
				// count Backspaces and Deletes
				if (event.keyCode == 8 || event.keyCode == 46) {
					errorCount++;
					document.getElementById("errors").innerHTML = errorCount;
				}
			}

			function getInput() {
				// on user's first keydown start the clock
				if (!started) {
					startTime = new Date();
					started = true;
				}

				// check if input is complete
				var compare = phrase.localeCompare(document.getElementById("input").value);
				if (compare == 0) {
					// stop the clock and calc time in seconds
					endTime = new Date();
					var timeDiff = (endTime - startTime) / 1000;

					document.getElementById("input").disabled = true;
					document.getElementById("time").innerHTML = timeDiff;
					document.getElementById("done").style.display = "block";
				}
			}
		</script>

		<p>
			<span class="intro">Type the phrase given below:</span>
			<br/>
			<script>
				document.write(phrase);
			</script>
		</p>
		<input type="text" size="80" id="input" onkeydown="getKey(event)" oninput="getInput()"/>
		<p>Num of errors: <span id="errors">0</span></p>
		<p id="done">Well done! Time elapsed: <span id="time"></span> seconds</p>
		<br/>


		<!--The following script records the coords of mouse on any mousemovement.
			ideas: min/max/avg speed/vertical speed/horizontal speed
			Similarly, we can do for clicks, scroll, etc.						 -->

		<script>
		document.onmousemove = handleMouseMove;
		setInterval(getMouseMove, 200); //track mouse movements every K milliseconds
		var mouseSpeedAvg=0.0, mouseSpeedMax=0.0, mouseSpeedMin=Infinity, mouseSpeedSum=0.0, nofMouseMoves=0;
		var mouseX, mouseY, oldmouseX, oldmouseY, timestamp, oldtimestamp;
		var mouseMoved = false;
		function handleMouseMove(e) {
			oldtimestamp = timestamp;
			oldmouseX = mouseX;
			oldmouseY = mouseY;
			timestamp = Date.now();
			mouseX = e.clientX;
			mouseY = e.clientY;
			mouseMoved = true;
		};

		function getMouseMove() {
			if (mouseMoved == true) {
				mouseMoved = false;
				mouseSpeed = ( Math.sqrt( Math.pow(oldmouseX - mouseX, 2) + Math.pow(oldmouseY - mouseY, 2) )  ) / ( (timestamp - oldtimestamp) / 1000 ); 
				mouseSpeedSum += mouseSpeed;
				nofMouseMoves += 1;
				mouseSpeedAvg = mouseSpeedSum / nofMouseMoves;
				if(mouseSpeed > mouseSpeedMax)
					mouseSpeedMax = mouseSpeed;
				if(mouseSpeed < mouseSpeedMin)
					mouseSpeedMin = mouseSpeed

				//console.log(mouseSpeed);
				//console.log(mouseSpeedSum);
				//console.log(nofMouseMoves);
				//console.log(mouseSpeedAvg);
				//console.log(mouseSpeedMax);
				//console.log(mouseSpeedMin);
			}
		};
		</script>

		<script>
		document.onclick = handleMouseClick
		var nofMouseClicks=0, lastTimeClicked = Date.now(), timeBetweenClicksMin=Infinity, timeBetweenClicksMax=0.0, timeBetweenClicksAvg=0.0, timeBetweenClicksSum=0.0;
		function handleMouseClick(e) {
			nofMouseClicks += 1;
			timeBetweenClicks = (Date.now() - lastTimeClicked) / 1000;
			lastTimeClicked = Date.now();
			timeBetweenClicksSum += timeBetweenClicks;
			timeBetweenClicksAvg = timeBetweenClicksSum / nofMouseClicks;
			if(timeBetweenClicks > timeBetweenClicksMax)
				timeBetweenClicksMax = timeBetweenClicks;
			if(timeBetweenClicks < timeBetweenClicksMin)
				timeBetweenClicksMin = timeBetweenClicks;

			console.log(timeBetweenClicksAvg);
			console.log(timeBetweenClicksMax);
			console.log(timeBetweenClicksMin);
		};
		</script>

		<script>	// for scrolling with wheel
		document.onwheel = handleWheelMove;
		var nofWheelEvents=0, scrolledUpwards=0, scrolledDownwards=0;
		function handleWheelMove(e) {
			nofWheelEvents += 1;
			if(e.deltaY > 0)	// not crossplatformed, reported in pixels for every browser, lines for firefox
				scrolledUpwards += e.deltaY;
			else
				scrolledDownwards -= e.deltaY;

			//console.log(nofWheelEvents);
			//console.log(scrolledUpwards);
			//console.log(scrolledDownwards);
		};
		</script>

		<script>	// typing metrics
		document.onkeydown = handleTyping;
		var nofKeysPressed=0, timeBetweenKeysMin=Infinity, timeBetweenKeysMax=0.0, timeBetweenKeysSum=0.0, timeBetweenKeysAvg=0.0, lastTimePressed = Date.now();
		function handleTyping(e){
			nofKeysPressed += 1;
			timeBetweenKeys = (Date.now() - lastTimePressed) / 1000;	// in seconds
			lastTimePressed = Date.now();
			timeBetweenKeysSum += timeBetweenKeys;
			timeBetweenKeysAvg = timeBetweenKeysSum / nofKeysPressed;
			if(timeBetweenKeys > timeBetweenKeysMax)
				timeBetweenKeysMax = timeBetweenKeys;
			if(timeBetweenKeys < timeBetweenKeysMin)
				timeBetweenKeysMin = timeBetweenKeys;


			//console.log(timeBetweenKeysAvg);
			//console.log(timeBetweenKeysMax);
			//console.log(timeBetweenKeysMin);
		};
		</script>

	</body>
</html>
