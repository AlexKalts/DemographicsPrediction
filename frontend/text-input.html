<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<link rel="stylesheet" type="text/css" href="assets/text-input.css">
		<link href="https://fonts.googleapis.com/css?family=Mukta" rel="stylesheet">
	</head>
	<body>
		<script>
			// disable Ctrl+V for the input
			window.onload = function() {
				document.getElementById("input").onpaste = function(e) {
					e.preventDefault();
				}
			}

			var phrase = "The quick brown fox jumps over the lazy dog";
			var errorCount = 0;
			var started = false;
			var startTime, endTime;

			function getKey(event) {
				// count Backspaces and Deletes
				if (event.keyCode == 8 || event.keyCode == 46) {
					errorCount++;
					document.getElementById("errors").innerHTML = errorCount;
				}
			}

			function getInput() {
				// on user's first keydown start the clock
				if (!started) {
					startTime = new Date();
					started = true;
				}

				// check if input is complete
				var compare = phrase.localeCompare(document.getElementById("input").value);
				if (compare == 0) {
					// stop the clock and calc time in seconds
					endTime = new Date();
					var timeDiff = (endTime - startTime) / 1000;

					document.getElementById("input").disabled = true;
					document.getElementById("time").innerHTML = timeDiff;
					document.getElementById("done").style.display = "block";
				}
			}
		</script>

		<p>
			<span class="intro">Type the phrase given below:</span>
			<br/>
			<script>
				document.write(phrase);
			</script>
		</p>
		<input type="text" size="80" id="input" onkeydown="getKey(event)" oninput="getInput()"/>
		<p>Num of errors: <span id="errors">0</span></p>
		<p id="done">Well done! Time elapsed: <span id="time"></span> seconds</p>
		<br/>

		<!--The following script records the coords of mouse on any mousemovement.
			ideas: min/max/avg speed/vertical speed/horizontal speed
			Similarly, we can do for clicks, scroll, etc.						 -->

		<p>Mouse:</p>

		<script>
		//document.onmousemove = function(event) { getMousemove(event) };
		document.onmousemove = handleMouseMove;
		setInterval(getMouseMove, 200); //track mouse movements every K milliseconds
		var data = "";
		var mouseX, mouseY, oldmouseX, oldmouseY, timestamp, oldtimestamp;
		var mouseMoved = false;
		function handleMouseMove(e) {
			data = "";
			data += Date.now() + " ";
			data += e.clientX + " ";
			data += e.clientY + " ";
			data += "mousemove\n";
			oldtimestamp = timestamp;
			oldmouseX = mouseX;
			oldmouseY = mouseY;
			timestamp = Date.now();
			mouseX = e.clientX;
			mouseY = e.clientY;
			mouseMoved = true;
			//document.getElementById("mousemovement").innerHTML = data;
		};

		function getMouseMove() {
			if (mouseMoved == true) {
				mouseMoved = false;
				document.getElementById("mousemovement").innerHTML = data;
				mouseXspeed = ( Math.abs(oldmouseX - mouseX) ) / ( (timestamp - oldtimestamp) / 1000);
				mouseYspeed = ( Math.abs(oldmouseY - mouseY) ) / ( (timestamp - oldtimestamp) / 1000);
				mousespeed = ( Math.sqrt( Math.pow(oldmouseX - mouseX, 2) + Math.pow(oldmouseY - mouseY, 2) )  ) / ( (timestamp - oldtimestamp) / 1000 ); 
				console.log(mouseXspeed);
				console.log(mouseYspeed);
				console.log(mousespeed);
			}
		};

		</script>
		<p id="mousemovement"></p>
	</body>
</html>
